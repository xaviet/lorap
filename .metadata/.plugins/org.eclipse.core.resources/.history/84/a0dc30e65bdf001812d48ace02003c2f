/*
 * drv_sx1278.c
 *
 *  Created on: Nov 3, 2018
 *      Author: mose
 */

#include "drv_sx1278.h"
#include "drv_spi.c"
#include "drv_gpio.h"
#include "drv_usart.h"

void init_sx1278()
{
  spi1ResetSet(LOW);
  delay_1us(10000);
  spi1ResetSet(HIGH);
  delay_1us(10000);
  u8 data = 0x00;
  sx1278_set_opmode(Sleep_mode);
  delay_1us(16);
  sx1278_write(sx1278_opMode,0x88);
  delay_1us(16);
  sx1278_write(sx1278_payloadLength, 0x80);
  sx1278_set_opmode(Stdby_mode);
  delay_1us(16);
  sx1278_write(sx1278_irqFlagsMask,0xb7);
  sx1278_read(sx1278_opMode, &data);
  if(data != 0x89)
  {
    usart_send_string("sx1278 Fault...\r\n");
  }
  else
  {
    sx1278_read(sx1278_version, &data);
    usart_send_string("sx1278 OK, Ver: 0x");
    usart_send_u8(data);
    usart_send_string("\r\n");
  }
}
